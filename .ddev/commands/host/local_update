#!/bin/bash

## Description: Local update script
## Usage: local_update
## Example: ddev local_update

echo "====================================="
echo "Installing Composer dependencies..."
echo "====================================="
ddev composer install

# Check which site to update based on argument or default to both
SITE="${1:-both}"

if [ "$SITE" = "main" ] || [ "$SITE" = "both" ]; then
    echo ""
    echo "====================================="
    echo "Updating main site (sahistory.org.za)..."
    echo "====================================="
    ddev drush cr
    ddev drush updb -y
    ddev drush cr
    ddev drush cim -y
    ddev drush cr
    ddev drush deploy:hook -y || true
    ddev drush cr
fi

if [ "$SITE" = "shop" ] || [ "$SITE" = "both" ]; then
    echo ""
    echo "====================================="
    echo "Updating shop site (shop.sahistory.org.za)..."
    echo "====================================="
    ddev drush --uri=shop.sahistory.org.za cr
    ddev drush --uri=shop.sahistory.org.za updb -y
    ddev drush --uri=shop.sahistory.org.za cr
    ddev drush --uri=shop.sahistory.org.za cim -y
    ddev drush --uri=shop.sahistory.org.za cr
    ddev drush --uri=shop.sahistory.org.za deploy:hook -y || true
    ddev drush --uri=shop.sahistory.org.za cr
fi

echo ""
echo "====================================="
echo "Update complete!"
echo "====================================="
