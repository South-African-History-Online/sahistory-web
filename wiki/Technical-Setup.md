# Technical Setup Guide

Complete guide for setting up the SA History Web development environment.

## Prerequisites

### Required Software
- **DDEV**: Latest version (containerized development environment)
- **Git**: Version control
- **Composer**: PHP dependency management (installed via DDEV)
- **Node.js & npm**: Frontend asset compilation (if needed)

### System Requirements
- **OS**: macOS, Linux, or Windows with WSL2
- **RAM**: Minimum 8GB (16GB recommended)
- **Disk Space**: 10GB free space
- **Ports**: 80, 443, 3306 (or configure DDEV to use alternatives)

## Installation Steps

### 1. Clone Repository
```bash
git clone https://github.com/your-org/sahistory-web.git
cd sahistory-web
```

### 2. DDEV Setup
```bash
# Start DDEV environment
ddev start

# Install Composer dependencies
ddev composer install

# Import database (if available)
ddev import-db --src=database/sahistory.sql.gz

# Import files (if available) 
ddev import-files --src=files/

# Clear Drupal cache
ddev drush cr

# Update database schema
ddev drush updb -y
```

### 3. Access the Site
- **Local URL**: https://sahistory-web.ddev.site
- **Admin Access**: `/user/login`
- **Database**: Access via `ddev describe` for connection details

## Configuration

### Drupal Settings
The site uses environment-specific settings:

```php
// settings.local.php (auto-generated by DDEV)
$settings['trusted_host_patterns'] = [
  '^sahistory-web\.ddev\.site$',
];
```

### Custom Module Setup
```bash
# Enable custom modules
ddev drush en saho_featured_articles -y

# Clear cache after enabling modules
ddev drush cr
```

### Theme Setup
```bash
# The custom SAHO theme should be active
ddev drush theme:enable saho
ddev drush config:set system.theme default saho
```

## Development Tools

### Useful DDEV Commands
```bash
# SSH into web container
ddev ssh

# View logs
ddev logs

# Database access
ddev mysql
ddev sequel-pro  # macOS with Sequel Pro

# Drush commands
ddev drush status
ddev drush uli  # Generate admin login link
ddev drush cr   # Clear cache
```

### Code Quality Tools
```bash
# PHP Code Sniffer (if configured)
ddev exec vendor/bin/phpcs --standard=Drupal webroot/modules/custom
ddev exec vendor/bin/phpcbf --standard=Drupal webroot/modules/custom

# Drupal Check (static analysis)
ddev exec vendor/bin/drupal-check webroot/modules/custom
```

## Directory Structure

```
sahistory-web/
├── .ddev/                 # DDEV configuration
├── webroot/              # Drupal docroot
│   ├── modules/
│   │   └── custom/       # Custom modules
│   │       └── saho_featured_articles/
│   ├── themes/
│   │   └── custom/       # Custom themes
│   │       └── saho/     # Main SAHO theme
│   └── sites/
│       └── default/
├── composer.json         # PHP dependencies
├── wiki/                 # Project documentation
└── README.md
```

## Environment Configuration

### Local Development (.env)
```bash
ENVIRONMENT=local
DEBUG=true
MYSQL_DATABASE=sahistory_local
MYSQL_USER=root
MYSQL_PASSWORD=root
```

### Featured Articles Module
The custom `saho_featured_articles` module provides:
- `/featured` route with dynamic content loading
- Category-based navigation (Liberation Struggle, Heritage Sites, etc.)
- Staff picks and featured content management
- South African history contextualized presentation

## Database Schema

### Key Content Types
- **Article**: Main historical articles
- **Biography**: Historical figures and personalities  
- **Place**: Historical locations and landmarks
- **Event**: Historical events and milestones
- **Archive**: Document collections and resources

### Custom Fields
- `field_staff_picks`: Boolean for editor selections
- `field_home_page_feature`: Boolean for homepage features
- `field_synopsis`: Article summaries
- Various image fields per content type

## Troubleshooting

### Common Issues

**DDEV won't start**
```bash
ddev poweroff
ddev start
```

**Database connection errors**
```bash
ddev restart
ddev drush cr
```

**Permission issues**
```bash
ddev exec chown -R www-data:www-data /var/www/html/webroot/sites/default/files
```

**Featured page shows 404**
```bash
# Ensure module is enabled
ddev drush pm:list | grep saho_featured
ddev drush en saho_featured_articles -y
ddev drush cr
```

**Template errors**
```bash
# Clear Twig cache
ddev drush cr
# Or specifically clear Twig cache
ddev drush cache:rebuild twig
```

### Getting Help

1. **Check DDEV status**: `ddev describe`
2. **View error logs**: `ddev logs`
3. **Database issues**: `ddev mysql` to connect directly
4. **Drupal issues**: `ddev drush status`

## Performance Tips

### Local Development
```bash
# Disable CSS/JS aggregation for development
ddev drush config:set system.performance css.preprocess 0
ddev drush config:set system.performance js.preprocess 0

# Enable Twig debugging (if needed)
ddev drush config:set system.theme debug 1
```

### Database Optimization
```bash
# Regular cache clears
ddev drush cr

# Database updates
ddev drush updb -y

# Configuration export/import
ddev drush cex -y  # Export
ddev drush cim -y  # Import
```

## Next Steps

After successful setup:
1. Review [Architecture Overview](Architecture.md)
2. Explore [Custom Modules](Custom-Modules.md) documentation
3. Check [Content Structure](Content-Structure.md) for data modeling
4. Read [Theme Development](Theme-Development.md) for frontend work

---

**Need help?** Check the [troubleshooting section](#troubleshooting) or open an issue in the project repository.