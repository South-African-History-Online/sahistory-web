<?php

/**
 * @file
 * Contains saho_utils.module.
 */

use Drupal\Core\Form\FormStateInterface;

/**
 * Implements hook_form_alter().
 */
function saho_utils_form_alter(&$form, FormStateInterface $form_state, $form_id) {
  // Alter the exposed form for the SAHO global search view.
  if ($form_id == 'views_exposed_form' && isset($form['#id']) && $form['#id'] == 'views-exposed-form-saho-global-search-page-1') {
    // Customize the fulltext search field options to rename body/title labels.
    if (isset($form['search_api_fulltext_searched_fields']) && isset($form['search_api_fulltext_searched_fields']['#options'])) {
      $options = &$form['search_api_fulltext_searched_fields']['#options'];

      // Replace the field labels with custom names.
      if (isset($options['body'])) {
        $options['body'] = t('Flexible Search');
      }
      if (isset($options['title'])) {
        $options['title'] = t('Strict Search');
      }
    }
  }

  // Extend the year range for event date field to support historical dates.
  // SAHO covers African history from earliest times to present.
  if ($form_id === 'node_event_form' || $form_id === 'node_event_edit_form') {
    if (isset($form['field_event_date']['widget'][0]['value'])) {
      // Allow dates from year 1000 to 2100 for historical events.
      // Note: Year must be 4 digits for Drupal's date range parser.
      $form['field_event_date']['widget'][0]['value']['#date_year_range'] = '1000:2100';
    }
  }
}
