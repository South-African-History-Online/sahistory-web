{#
/**
 * @file
 * Theme implementation for the Africa Regions block.
 *
 * Available variables:
 * - regions: Array of region data:
 *   - id: Region ID (north, east, southern, central, west)
 *   - label: Display label (e.g., "North Africa")
 *   - description: Region description
 *   - color: Hex color for region
 *   - count: Number of articles
 *   - featured_country: Featured country name
 *   - url: Link to region page
 * - block_title: Block title
 * - intro_text: Introduction text
 * - display_mode: Display mode (grid, carousel, list)
 * - show_content_count: Whether to show content counts
 * - show_featured_country: Whether to show featured countries
 *
 * @ingroup themeable
 */
#}
<div class="africa-regions-block">
  {% if block_title %}
    <h2 class="block-title mb-3">{{ block_title }}</h2>
  {% endif %}

  {% if intro_text %}
    <p class="block-intro text-muted mb-4">{{ intro_text }}</p>
  {% endif %}

  {% if regions %}
    <div class="regions-wrapper display-mode-{{ display_mode }}">
      {% if display_mode == 'carousel' %}
        {# Carousel mode #}
        <div id="africaRegionsCarousel" class="carousel slide" data-bs-ride="carousel">
          <div class="carousel-indicators">
            {% for region in regions %}
              <button type="button" data-bs-target="#africaRegionsCarousel" data-bs-slide-to="{{ loop.index0 }}"
                      class="{{ loop.first ? 'active' : '' }}" aria-label="{{ region.label }}"></button>
            {% endfor %}
          </div>

          <div class="carousel-inner">
            {% for region in regions %}
              <div class="carousel-item {{ loop.first ? 'active' : '' }}">
                {{ _self.region_card(region, show_content_count, show_featured_country) }}
              </div>
            {% endfor %}
          </div>

          <button class="carousel-control-prev" type="button" data-bs-target="#africaRegionsCarousel" data-bs-slide="prev">
            <span class="carousel-control-prev-icon" aria-hidden="true"></span>
            <span class="visually-hidden">{{ 'Previous'|t }}</span>
          </button>
          <button class="carousel-control-next" type="button" data-bs-target="#africaRegionsCarousel" data-bs-slide="next">
            <span class="carousel-control-next-icon" aria-hidden="true"></span>
            <span class="visually-hidden">{{ 'Next'|t }}</span>
          </button>
        </div>

      {% elseif display_mode == 'list' %}
        {# List mode #}
        <div class="regions-list">
          {% for region in regions %}
            {{ _self.region_card(region, show_content_count, show_featured_country) }}
          {% endfor %}
        </div>

      {% else %}
        {# Grid mode (default) #}
        <div class="saho-cards-grid africa-regions-grid">
          {% for region in regions %}
            {{ _self.region_card(region, show_content_count, show_featured_country) }}
          {% endfor %}
        </div>
      {% endif %}
    </div>
  {% else %}
    <div class="alert alert-info">
      <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" class="me-2" aria-hidden="true">
        <circle cx="12" cy="12" r="10"></circle>
        <line x1="12" y1="16" x2="12" y2="12"></line>
        <line x1="12" y1="8" x2="12.01" y2="8"></line>
      </svg>
      {{ 'No regional content available.'|t }}
    </div>
  {% endif %}
</div>

{#
/**
 * Region card macro for reusable card rendering.
 */
#}
{% macro region_card(region, show_count, show_featured) %}
  <div class="saho-card africa-region-card region-{{ region.id }}" style="--region-color: {{ region.color }}">
    <a href="{{ region.url }}" class="saho-card-link">
      <div class="saho-card-image region-image">
        {# Region icon badge #}
        <div class="region-badge">
          {% if region.id == 'north' %}
            {# Desert dunes for North Africa #}
            <svg class="region-icon" width="40" height="40" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5" aria-hidden="true">
              <path d="M2 17c5-3 10 2 15-2s7 4 7 4"></path>
              <path d="M2 12c5-3 10 2 15-2s7 4 7 4"></path>
              <circle cx="6" cy="7" r="1"></circle>
              <circle cx="19" cy="4" r="1"></circle>
            </svg>
          {% elseif region.id == 'east' %}
            {# Mountains for East Africa #}
            <svg class="region-icon" width="40" height="40" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5" aria-hidden="true">
              <path d="M3 20l5-10 4 8 6-14 3 6"></path>
              <path d="M3 20h18"></path>
            </svg>
          {% elseif region.id == 'southern' %}
            {# Sun/star for Southern Africa #}
            <svg class="region-icon" width="40" height="40" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5" aria-hidden="true">
              <circle cx="12" cy="12" r="4"></circle>
              <path d="M12 2v2m0 16v2M4.93 4.93l1.41 1.41m11.32 11.32l1.41 1.41M2 12h2m16 0h2M4.93 19.07l1.41-1.41m11.32-11.32l1.41-1.41"></path>
            </svg>
          {% elseif region.id == 'central' %}
            {# Forest/trees for Central Africa #}
            <svg class="region-icon" width="40" height="40" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5" aria-hidden="true">
              <path d="M12 3l4 7h-2l3 6h-3v5h-4v-5H7l3-6H8z"></path>
              <circle cx="18" cy="8" r="2"></circle>
              <circle cx="6" cy="11" r="2"></circle>
            </svg>
          {% elseif region.id == 'west' %}
            {# Waves for West Africa #}
            <svg class="region-icon" width="40" height="40" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5" aria-hidden="true">
              <path d="M2 12c1.5-2 3-2 4.5 0s3 2 4.5 0 3-2 4.5 0 3 2 4.5 0"></path>
              <path d="M2 17c1.5-2 3-2 4.5 0s3 2 4.5 0 3-2 4.5 0 3 2 4.5 0"></path>
              <circle cx="6" cy="7" r="1"></circle>
              <circle cx="12" cy="5" r="1"></circle>
            </svg>
          {% else %}
            {# Default Africa continent shape #}
            <svg class="region-icon" width="40" height="40" viewBox="0 0 24 24" fill="currentColor" aria-hidden="true">
              <path d="M12 2c-1 0-2 1-3 2s-2 1-2 3 0 3 1 4-1 2-1 3 1 2 2 3 2 2 3 2 2-1 3-2 2-2 2-3 0-2-1-3 1-2 1-4-1-2-2-3-2-2-3-2z"></path>
            </svg>
          {% endif %}
        </div>
        {# Decorative pattern #}
        <div class="region-pattern"></div>
      </div>

      <div class="saho-card-content">
        <h3 class="saho-card-title">{{ region.label }}</h3>

        <p class="region-description text-muted mb-3">{{ region.description }}</p>

        {% if show_featured and region.featured_country %}
          <div class="featured-country">
            <svg class="featured-icon" width="16" height="16" viewBox="0 0 24 24" fill="currentColor" aria-hidden="true">
              <path d="M5 3v18l7-3 7 3V3z"></path>
            </svg>
            <span class="country-text">{{ 'Featured: @country'|t({'@country': region.featured_country}) }}</span>
          </div>
        {% endif %}

        {% if show_count %}
          <div class="region-count">
            <svg class="count-icon" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" aria-hidden="true">
              <path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"></path>
              <polyline points="14 2 14 8 20 8"></polyline>
            </svg>
            <span class="count-number">{{ region.count }}</span>
            <span class="count-label">{{ region.count == 1 ? 'article'|t : 'articles'|t }}</span>
          </div>
        {% endif %}

        <div class="saho-card-footer">
          <span class="saho-card-button">
            {{ 'View Region'|t }}
            <svg class="button-icon" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" aria-hidden="true">
              <line x1="5" y1="12" x2="19" y2="12"></line>
              <polyline points="12 5 19 12 12 19"></polyline>
            </svg>
          </span>
        </div>
      </div>
    </a>
  </div>
{% endmacro %}
