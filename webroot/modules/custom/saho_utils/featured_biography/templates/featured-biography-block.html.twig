{#
/**
 * @file
 * Featured biography block template.
 */
#}
<div class="featured-biography-block{% if enable_carousel %} enable-carousel{% endif %}">
  {# Add block title #}
  <h2 class="block-title">{{ display_title }}</h2>
  
  {% if block_description is not empty %}
    <p class="block-description">{{ block_description }}</p>
  {% endif %}

  {% if biography_data is defined and biography_data is not empty and biography_data.items is defined and biography_data.items is not empty %}
    {# Multiple biographies display #}
    <div class="saho-cards-grid">
      {% for item in biography_data.items %}
        <div class="saho-card{% if item.is_demo %} saho-card--demo{% endif %}">
          <a href="{{ item.url }}" class="saho-card-link">
            <div class="saho-card-image">
              {% if item.image %}
                <img src="{{ item.image }}" alt="{{ item.title|striptags }}" />
              {% else %}
                <div class="saho-card-image--placeholder">
                  <i class="fas fa-user-circle fa-3x"></i>
                </div>
              {% endif %}
            </div>
            <div class="saho-card-content">
              {% if item.categories is defined and item.categories is not empty %}
                {% for category in item.categories|slice(0, 1) %}
                  <div class="saho-card-badge">{{ category.name }}</div>
                {% endfor %}
              {% endif %}
              <h3 class="saho-card-title">{{ item.title|raw }}</h3>
              {% if item.dates %}
                <div class="saho-card-subtitle">{{ item.dates }}</div>
              {% endif %}
              {% if item.body %}
                <div class="saho-card-description">
                  {{ item.body|raw|striptags|truncate(150, true, '...') }}
                </div>
              {% endif %}
              <div class="saho-card-footer">
                <span class="saho-card-button">
                  {{ 'Read biography'|t }}
                  <i class="fas fa-arrow-right ml-2"></i>
                </span>
              </div>
            </div>
          </a>
        </div>
      {% endfor %}
    </div>
    
    {% if enable_carousel and biography_data.items|length > 1 %}
      <div class="featured-biography-carousel-controls">
        <button class="featured-bio-prev-btn carousel-button" type="button" 
          onclick="var grid = this.closest('.featured-biography-block').querySelector('.saho-cards-grid'); 
                  var style = window.getComputedStyle(grid);
                  var matrix = new DOMMatrix(style.transform);
                  var currentX = matrix.m41;
                  var cardWidth = grid.querySelector('.saho-card').offsetWidth + 24;
                  var cardsPerView = 3;
                  var cardIndex = Math.floor(Math.abs(currentX) / cardWidth);
                  // Move one full view (3 cards) backward
                  var newCardIndex = Math.max(0, cardIndex - cardsPerView);
                  var newX = -newCardIndex * cardWidth;
                  
                  // Add smooth animation
                  grid.style.transition = 'transform 0.5s ease';
                  grid.style.transform = 'translateX(' + newX + 'px)';
                  
                  // Update active indicator
                  var indicators = this.closest('.featured-biography-carousel-controls').querySelectorAll('.featured-bio-indicator');
                  var activeIndex = Math.floor(newCardIndex / cardsPerView);
                  for (var j = 0; j < indicators.length; j++) {
                    indicators[j].classList.remove('active');
                    if (j === activeIndex) {
                      indicators[j].classList.add('active');
                    }
                  }
                  
                  this.classList.add('button-clicked');
                  setTimeout(function() { 
                    var btn = document.querySelector('.button-clicked'); 
                    if (btn) btn.classList.remove('button-clicked'); 
                  }, 300);
                  
                  console.log('Previous button clicked, showing cards starting at index: ' + newCardIndex);
                  return false;"
          aria-label="{{ 'Previous biography'|t }}">
          <i class="fas fa-chevron-left"></i>
        </button>
        <div class="featured-bio-indicators">
          {% for i in 0..((biography_data.items|length / 3)|round(0, 'ceil') - 1) %}
            <button 
              class="featured-bio-indicator{% if loop.first %} active{% endif %}" 
              type="button"
              onclick="var grid = this.closest('.featured-biography-block').querySelector('.saho-cards-grid');
                      var cardWidth = grid.querySelector('.saho-card').offsetWidth + 24;
                      var cardsPerView = 3;
                      var newCardIndex = {{ i }} * cardsPerView;
                      var newX = -newCardIndex * cardWidth;
                      
                      // Add smooth animation
                      grid.style.transition = 'transform 0.5s ease';
                      grid.style.transform = 'translateX(' + newX + 'px)';
                      
                      var indicators = this.closest('.featured-bio-indicators').querySelectorAll('.featured-bio-indicator');
                      for (var j = 0; j < indicators.length; j++) {
                        indicators[j].classList.remove('active');
                      }
                      this.classList.add('active');
                      console.log('Indicator ' + {{ i }} + ' clicked, showing cards starting at index: ' + newCardIndex);
                      return false;"
              data-slide-to="{{ i }}" 
              aria-label="{{ 'Biography'|t }} {{ i + 1 }}"
            ></button>
          {% endfor %}
        </div>
        <button class="featured-bio-next-btn carousel-button" type="button" 
          onclick="var grid = this.closest('.featured-biography-block').querySelector('.saho-cards-grid'); 
                  var style = window.getComputedStyle(grid);
                  var matrix = new DOMMatrix(style.transform);
                  var currentX = matrix.m41;
                  var cardWidth = grid.querySelector('.saho-card').offsetWidth + 24;
                  var cardsPerView = 3;
                  var cardIndex = Math.floor(Math.abs(currentX) / cardWidth);
                  // Move one full view (3 cards) forward
                  var newCardIndex = Math.min(grid.querySelectorAll('.saho-card').length - cardsPerView, cardIndex + cardsPerView);
                  var newX = -newCardIndex * cardWidth;
                  
                  // Add smooth animation
                  grid.style.transition = 'transform 0.5s ease';
                  grid.style.transform = 'translateX(' + newX + 'px)';
                  
                  // Update active indicator
                  var indicators = this.closest('.featured-biography-carousel-controls').querySelectorAll('.featured-bio-indicator');
                  var activeIndex = Math.floor(newCardIndex / cardsPerView);
                  for (var j = 0; j < indicators.length; j++) {
                    indicators[j].classList.remove('active');
                    if (j === activeIndex) {
                      indicators[j].classList.add('active');
                    }
                  }
                  
                  this.classList.add('button-clicked');
                  setTimeout(function() { 
                    var btn = document.querySelector('.button-clicked'); 
                    if (btn) btn.classList.remove('button-clicked'); 
                  }, 300);
                  
                  console.log('Next button clicked, showing cards starting at index: ' + newCardIndex);
                  return false;" 
          aria-label="{{ 'Next biography'|t }}">
          <i class="fas fa-chevron-right"></i>
        </button>
      </div>
    {% endif %}
    
  {% elseif biography_item is defined and biography_item is not empty %}
    {# Single biography display #}
    <div class="featured-biography-content">
      <div class="featured-biography-item">
        {% if biography_item.image %}
          <div class="featured-biography-image">
            <a href="{{ biography_item.url }}">
              <img src="{{ biography_item.image }}" alt="{{ biography_item.title|striptags }}" />
            </a>
          </div>
        {% endif %}
        <div class="featured-biography-details">
          {% if biography_item.category %}
            <div class="featured-biography-categories">
              <a href="{{ biography_item.category_url }}" class="featured-biography-category">{{ biography_item.category }}</a>
            </div>
          {% endif %}
          <h3 class="featured-biography-title">
            <a href="{{ biography_item.url }}">{{ biography_item.title|raw }}</a>
          </h3>
          {% if biography_item.dates %}
            <div class="featured-biography-dates">{{ biography_item.dates }}</div>
          {% endif %}
          {% if biography_item.position %}
            <div class="featured-biography-position">{{ biography_item.position }}</div>
          {% endif %}
          {% if biography_item.body %}
            <div class="featured-biography-summary">
              {{ biography_item.body|raw }}
            </div>
          {% endif %}
          <div class="featured-biography-read-more">
            <a href="{{ biography_item.url }}" class="featured-biography-link">{{ 'Read biography'|t }}</a>
          </div>
        </div>
      </div>
    </div>
  {% else %}
    {# Empty state #}
    <div class="featured-biography-empty">
      <p>{{ 'No featured biography available at this time.'|t }}</p>
    </div>
  {% endif %}
  
  {% if show_admin_info %}
    <div class="featured-biography-admin-info">
      <h4>{{ 'Admin Information'|t }}</h4>
      <dl>
        <dt>{{ 'Selection Method'|t }}</dt>
        <dd>{{ selection_method }}</dd>
        {% if entity_count %}
          <dt>{{ 'Entity Count'|t }}</dt>
          <dd>{{ entity_count }}</dd>
        {% endif %}
        {% if highlight_category %}
          <dt>{{ 'Highlight Category'|t }}</dt>
          <dd>{{ highlight_category }}</dd>
        {% endif %}
        <dt>{{ 'Display Mode'|t }}</dt>
        <dd>{{ display_mode }}</dd>
        <dt>{{ 'Carousel Enabled'|t }}</dt>
        <dd>{{ enable_carousel ? 'Yes'|t : 'No'|t }}</dd>
      </dl>
    </div>
  {% endif %}
</div>