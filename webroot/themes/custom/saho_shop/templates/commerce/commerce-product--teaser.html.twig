{#
/**
 * @file
 * Theme override for product teaser display.
 *
 * Available variables:
 * - product: The product entity.
 * - product_url: The URL for the product page.
 * - attributes: HTML attributes for the wrapper.
 * - content: Render array of product fields.
 */
#}
{% set classes = [
  'product-card',
  'product-card--grid',
  'product-card--' ~ product.bundle|clean_class,
] %}

<article{{ attributes.addClass(classes) }}>
  {# Product Image - check multiple possible field names #}
  {% set image_field = content.field_images|render ? content.field_images : (content.field_image|render ? content.field_image : (content.variations|render ? content.variations : null)) %}

  {% if image_field %}
    <div class="product-card__image">
      {% if content.field_badge|render %}
        <span class="product-card__badge product-card__badge--{{ content.field_badge[0]['#markup']|clean_class }}">
          {{ content.field_badge }}
        </span>
      {% endif %}
      <a href="{{ product_url }}">
        {{ image_field }}
      </a>
    </div>
  {% else %}
    {# Placeholder image if no image exists #}
    <div class="product-card__image">
      <a href="{{ product_url }}">
        <div style="aspect-ratio: 1; background: #f8fafc; display: flex; align-items: center; justify-content: center; color: #94a3b8;">
          <svg width="48" height="48" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <rect x="3" y="3" width="18" height="18" rx="2" ry="2"></rect>
            <circle cx="8.5" cy="8.5" r="1.5"></circle>
            <polyline points="21 15 16 10 5 21"></polyline>
          </svg>
        </div>
      </a>
    </div>
  {% endif %}

  <div class="product-card__body">
    {# Category or Publisher #}
    {% if content.field_categories|render %}
      <div class="product-card__category">
        {{ content.field_categories }}
      </div>
    {% elseif content.field_publisher|render %}
      <div class="product-card__category">
        {{ content.field_publisher }}
      </div>
    {% endif %}

    <h3 class="product-card__title">
      <a href="{{ product_url }}">
        {{ product.label }}
      </a>
    </h3>

    {# Author or subtitle #}
    {% if content.field_author|render %}
      <div class="product-card__author">
        {{ 'by'|t }} {{ content.field_author }}
      </div>
    {% endif %}

    {# Description or body #}
    {% if content.body|render %}
      <div class="product-card__description">
        {{ content.body }}
      </div>
    {% elseif content.field_subtitle|render %}
      <div class="product-card__description">
        {{ content.field_subtitle }}
      </div>
    {% endif %}

    {# Price from variations #}
    {% if content.variations|render %}
      <div class="product-card__price">
        {{ content.variations }}
      </div>
    {% endif %}

    <div class="product-card__actions">
      <a href="{{ product_url }}" class="product-card__add-to-cart">
        {{ 'View Details'|t }} â†’
      </a>
    </div>
  </div>
</article>
