{#
/**
 * @file
 * Theme override to display a teaser view of an upcoming event node.
 * Uses the saho-upcoming-events-card SDC component for consistent rendering.
 */
#}

{# Prepare image data #}
{% set image_data = null %}
{% if node.field_upcomingevent_image.0 and node.field_upcomingevent_image.entity %}
  {% set image_data = {
    url: file_url(node.field_upcomingevent_image.entity.uri.value),
    alt: node.field_upcomingevent_image.alt|default(label)
  } %}
{% endif %}

{# Format start date for display #}
{% set formatted_start_date = null %}
{% if node.field_start_date.value %}
  {% if node.field_end_date.value %}
    {# Multi-day or same-day with end time #}
    {% set start_date_only = node.field_start_date.value|date('Y-m-d') %}
    {% set end_date_only = node.field_end_date.value|date('Y-m-d') %}
    {% if start_date_only == end_date_only %}
      {# Same day event - show date once with time range #}
      {% set formatted_start_date = node.field_start_date.value|date('j F Y, H:i') ~ ' - ' ~ node.field_end_date.value|date('H:i') %}
    {% else %}
      {# Multi-day event - show full date and time for both #}
      {% set formatted_start_date = node.field_start_date.value|date('j F Y, H:i') ~ ' - ' ~ node.field_end_date.value|date('j F Y, H:i') %}
    {% endif %}
  {% else %}
    {# No end date - just show start date and time #}
    {% set formatted_start_date = node.field_start_date.value|date('j F Y, H:i') %}
  {% endif %}
{% endif %}

{# Embed the SDC component #}
{% embed 'saho:saho-upcoming-events-card' with {
  title: label,
  url: url,
  image: image_data,
  event_status: event_status,
  event_status_label: event_status_label,
  event_badge_variant: event_badge_variant,
  show_pulse: show_pulse,
  countdown: countdown,
  start_date: formatted_start_date,
  venue: node.field_upcoming_venue.value,
  body_excerpt: content.body,
  card_format: view_mode_card_format|default('standard'),
  attributes: attributes
} %}

  {# Status Badge Slot - Only for "Happening Now" and "Past", not "Upcoming" #}
  {% block status_badge %}
    {% if event_status and event_status != 'upcoming' %}
      {% include 'saho:saho-badge' with {
        text: event_status_label,
        variant: event_badge_variant,
        size: 'small',
        icon: event_status == 'in-progress' ? 'circle' : 'calendar-check',
        rounded: true,
        uppercase: true,
        position: 'top-left'
      } %}
      {% if show_pulse %}
        <span class="badge-pulse" aria-hidden="true"></span>
      {% endif %}
    {% endif %}
  {% endblock %}

  {# Countdown Badge Slot - Only for upcoming events #}
  {% block countdown_badge %}
    {% if countdown and event_status == 'upcoming' %}
      <svg class="saho-upcoming-events-card__icon" width="16" height="16" viewBox="0 0 24 24" fill="currentColor">
        <path d="M19 3h-1V1h-2v2H8V1H6v2H5c-1.11 0-1.99.9-1.99 2L3 19c0 1.1.89 2 2 2h14c1.1 0 2-.9 2-2V5c0-1.1-.9-2-2-2zm0 16H5V8h14v11zM7 10h5v5H7z"/>
      </svg>
      <span>{{ event_status_label }}</span>
    {% endif %}
  {% endblock %}

{% endembed %}
