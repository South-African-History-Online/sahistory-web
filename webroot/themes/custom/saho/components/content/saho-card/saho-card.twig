{#
/**
 * @file
 * SAHO Card Component Template
 * 
 * Drupal 11 Single Directory Component (SDC)
 * Reusable card for displaying content with SAHO heritage branding
 *
 * Props:
 * - title (string, required): Card title
 * - content (string): Main content text
 * - image (object): { url: string, alt: string }
 * - url (string): Link destination
 * - variant (string): primary|secondary|accent|highlight
 * - size (string): small|medium|large
 * - content_type (string): biography|place|event|article
 * - metadata (object): { date, author, category, featured, staff_pick }
 *
 * Slots:
 * - card_header: Optional header content
 * - card_footer: Optional footer content  
 * - card_badge: Optional badge content
 */
#}

{%
  set classes = [
    'saho-card',
    'card',
    'h-100',
    variant ? 'saho-card--' ~ variant : 'saho-card--primary',
    size ? 'saho-card--' ~ size : 'saho-card--medium',
    content_type ? 'saho-card--type-' ~ content_type|replace({'_': '-'}) : 'saho-card--type-article'
  ]
%}

{%
  set card_classes = [
    'saho-grid-item'
  ]
%}

<div class="{{ card_classes|join(' ') }}">
  <article class="{{ classes|join(' ') }}" {% if url %}role="link" tabindex="0"{% endif %}>
    
    {# Card Header Slot #}
    {% if slots.card_header %}
      <div class="saho-card__header">
        {{ slots.card_header }}
      </div>
    {% endif %}
    
    {# Image Section #}
    {% if image and image.url %}
      <div class="card-img-top-wrapper position-relative overflow-hidden saho-card__image">
        <img src="{{ image.url }}" 
             alt="{{ image.alt|default(title) }}" 
             class="card-img-top w-100 h-100 saho-card__img"
             loading="lazy"
             style="object-fit: cover; height: 200px;">
        
        {# Content Type Badge #}
        <div class="position-absolute top-0 end-0 m-2">
          <span class="badge saho-card__type-badge">
            {{ content_type|replace({'_': ' '})|title|default('Article') }}
          </span>
        </div>
        
        {# Badge Slot - Custom badges #}
        {% if slots.card_badge %}
          <div class="position-absolute top-0 start-0 m-2">
            {{ slots.card_badge }}
          </div>
        {% endif %}
      </div>
    {% else %}
      {# Fallback placeholder - SVG for biographies, icons for others #}
      {% if content_type == 'biography' %}
        <div class="card-img-top saho-card__placeholder" style="height: 200px; position: relative; overflow: hidden;">
          <img src="/themes/custom/saho/images/default-portrait.svg" alt="Biography portrait" class="w-100 h-100" style="object-fit: cover;">
          <div class="position-absolute top-0 end-0 m-2">
            <span class="badge saho-card__type-badge">
              {{ content_type|replace({'_': ' '})|title|default('Biography') }}
            </span>
          </div>
        </div>
      {% else %}
        <div class="card-img-top bg-light d-flex align-items-center justify-content-center saho-card__placeholder"
             style="height: 200px; position: relative;">
          {% if content_type == 'place' %}
            <i class="fas fa-map-marker-alt fa-3x text-muted" aria-hidden="true"></i>
          {% elseif content_type == 'event' %}
            <i class="fas fa-calendar-alt fa-3x text-muted" aria-hidden="true"></i>
          {% else %}
            <i class="fas fa-file-alt fa-3x text-muted" aria-hidden="true"></i>
          {% endif %}

          <div class="position-absolute top-0 end-0 m-2">
            <span class="badge saho-card__type-badge">
              {{ content_type|replace({'_': ' '})|title|default('Article') }}
            </span>
          </div>
        </div>
      {% endif %}
    {% endif %}
    
    {# Card Body #}
    <div class="card-body d-flex flex-column saho-card__body">
      
      {# Title #}
      <h3 class="card-title saho-card__title">
        {% if url %}
          <a href="{{ url }}" class="text-decoration-none stretched-link saho-card__link">
            {{ title }}
          </a>
        {% else %}
          {{ title }}
        {% endif %}
      </h3>
      
      {# Metadata - Date/Author #}
      {% if metadata %}
        <div class="saho-card__meta text-muted small mb-2">
          {% if metadata.date %}
            <span class="saho-card__date">
              <i class="fas fa-clock me-1" aria-hidden="true"></i>
              {{ metadata.date }}
            </span>
          {% endif %}
          {% if metadata.author %}
            <span class="saho-card__author ms-2">
              <i class="fas fa-user me-1" aria-hidden="true"></i>
              {{ metadata.author }}
            </span>
          {% endif %}
        </div>
      {% endif %}
      
      {# Content #}
      {% if content %}
        <div class="card-text saho-card__content text-muted mb-3">
          {{ content|length > 120 ? content|slice(0, 120) ~ '...' : content }}
        </div>
      {% endif %}
      
      {# Footer Section #}
      <div class="mt-auto saho-card__footer-section">

        {# Card Action Button - uses saho-button component #}
        {% if button_text and url %}
          <div class="saho-card__action mb-2">
            {# Button is visual only since stretched-link makes entire card clickable #}
            {# Using span wrapper to avoid nested links (invalid HTML) #}
            <span class="saho-card-button-wrapper" style="position: relative; z-index: 2;">
              <span class="saho-button saho-button--{{ button_variant|default('card-action') }} saho-button--{{ button_size|default('small') }}">
                <span class="saho-button__text">{{ button_text }}</span>
                {% if button_icon|default('arrow-right') == 'arrow-right' %}
                  <svg class="saho-button__icon saho-button__icon--arrow-right" width="14" height="14" viewBox="0 0 16 16" fill="currentColor" aria-hidden="true">
                    <path fill-rule="evenodd" d="M1 8a.5.5 0 0 1 .5-.5h11.793l-3.147-3.146a.5.5 0 0 1 .708-.708l4 4a.5.5 0 0 1 0 .708l-4 4a.5.5 0 0 1-.708-.708L13.293 8.5H1.5A.5.5 0 0 1 1 8z"/>
                  </svg>
                {% elseif button_icon == 'external' %}
                  <svg class="saho-button__icon saho-button__icon--external" width="14" height="14" viewBox="0 0 16 16" fill="currentColor" aria-hidden="true">
                    <path fill-rule="evenodd" d="M8.636 3.5a.5.5 0 0 0-.5-.5H1.5A1.5 1.5 0 0 0 0 4.5v10A1.5 1.5 0 0 0 1.5 16h10a1.5 1.5 0 0 0 1.5-1.5V7.864a.5.5 0 0 0-1 0V14.5a.5.5 0 0 1-.5.5h-10a.5.5 0 0 1-.5-.5v-10a.5.5 0 0 1 .5-.5h6.636a.5.5 0 0 0 .5-.5z"/>
                    <path fill-rule="evenodd" d="M16 .5a.5.5 0 0 0-.5-.5h-5a.5.5 0 0 0 0 1h3.793L6.146 9.146a.5.5 0 1 0 .708.708L15 1.707V5.5a.5.5 0 0 0 1 0v-5z"/>
                  </svg>
                {% endif %}
              </span>
            </span>
          </div>
        {% endif %}

        {# Card Footer Slot #}
        {% if slots.card_footer %}
          <div class="saho-card__footer mb-2">
            {{ slots.card_footer }}
          </div>
        {% endif %}

        {# Status Badges and Category #}
        <div class="d-flex justify-content-between align-items-center">
          {% if metadata and metadata.category %}
            <small class="text-muted saho-card__category">
              {{ metadata.category }}
            </small>
          {% endif %}

          <div class="btn-group saho-card__badges">
            {% if metadata and metadata.staff_pick %}
              <span class="badge bg-warning text-dark saho-card__staff-pick">
                <i class="fas fa-star me-1" aria-hidden="true"></i>
                Staff Pick
              </span>
            {% endif %}
            {% if metadata and metadata.featured %}
              <span class="badge bg-info saho-card__featured">
                <i class="fas fa-bookmark me-1" aria-hidden="true"></i>
                Featured
              </span>
            {% endif %}
          </div>
        </div>
      </div>
      
    </div>
  </article>
</div>